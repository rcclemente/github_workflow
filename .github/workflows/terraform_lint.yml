---
name: Terraform Lint
on:
  pull_request:
    types: [opened, synchronize, reopened, labeled]
    paths:
      - 'terraform/**.tf'
      - 'terraform/vars/**.tfvars'
jobs:
  set-environment:
    if: |
        github.event.issue.pull_request &&
        (
          github.head_ref == 'dev' ||
          github.head_ref == 'uat' ||
          github.head_ref == 'prod'
        )
    runs-on: ubuntu-latest
    name: Set Environment
    steps:
      - name: Set Environment
        run: |
          case "${{ github.ref }}" in
           'ref/heads/dev' )
             echo "::set-output name=workflow_environment::dev"
             ;;
           'ref/heads/uat' )
             echo "::set-output name=workflow_environment::uat"
             ;;
           'ref/heads/prod' )
             echo "::set-output name=workflow_environment::prod"
             ;;
           *)
            echo "no match"
            exit 1
            ;;
          esac

  validate:
    needs: set-environment
    runs-on: ubuntu-latest
    name: Validate terraform configuration
    steps:
      - name: Checkout
        uses: actions/checkout@v2
