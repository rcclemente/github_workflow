---
name: Terraform Lint
on:
  pull_request:
    types: [opened, synchronize, reopened, labeled]
    paths:
      - 'terraform/**.tf'
      - 'terraform/vars/**.tfvars'
jobs:
  show-environment:
    runs-on: ubuntu-latest
    name: Show Environment
    steps:
      - name: test
        run: |
          echo "env=${{ github.event.pull_request.base.ref }}"
          echo "issue.pull_request=${{ github.event.issue.pull_request }}"
  set-environment:
    if: |
      github.event_name != '' &&
      (
        github.event.pull_request.base.ref == 'dev' ||
        github.event.pull_request.base.ref == 'uat' ||
        github.event.pull_request.base.ref == 'prod'
      )
    runs-on: ubuntu-latest
    name: Set Environment
    steps:
      - name: test
        run: |
          echo "running"
      - name: Set Environment
        run: |
          echo "::set-output name=workflow_environment::${{ github.event.pull_request.base.ref }}"

  validate:
    needs: set-environment
    runs-on: ubuntu-latest
    name: Validate terraform configuration
    steps:
      - name: Checkout
        uses: actions/checkout@v2
