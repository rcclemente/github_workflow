name: Terraform
on:
  issue_comment:
    types: [ created ]

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

permissions:
  id-token: write
  contents: read
  pull-requests: write

jobs:
  show-environment:
    runs-on: ubuntu-latest
    name: Show Environment
    steps:
      - name: test
        run: |
          echo "env=${{ github.ref }}"
          echo "issue.pull_request=${{ github.event.issue.pull_request }}"
  set-environment:
    if: |
      github.event.issue.pull_request &&
      (
        github.ref  == 'refs/heads/dev' ||
        github.ref  == 'refs/heads/uat' ||
        github.ref  == 'refs/heads/prod'
      )
    runs-on: ubuntu-latest
    name: Set Environment
    steps:
      - name: test
        run: |
          echo "running"
      - name: Get Reference 
        run: |
          echo "REF=$(echo ${{ github.ref }} | cut -d '/' -f 3)" >> $GITHUB_ENV
          echo "current_reference=${{ env.REF }}"
      - name: Set Environment
        run: |
          echo "::set-output name=workflow_environment::${{ env.REF }}"
